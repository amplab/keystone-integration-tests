#!/bin/bash

# Figure out where we are.
FWDIR="$(cd `dirname $0`; pwd)"

DATE=`data +%Y%m%d.%H%M%S`

export KEYSTONE_DIR=$(PWDIR)/../../keystone
export KEYSTONE_VERSION=$1 #TODO: Argument validation.

if [ ! -d logs ]; then
  mkdir -p logs
fi

TEST_NAME=all #TODO: Make this a parameter.
LOG_FILE=logs/$TEST_NAME.$DATE.log

bash $(FWDIR)/prep.sh
bash $(FWDIR)/build.sh
bash $(FWDIR)/run-test.sh $TEST_NAME >$LOG_FILE 2&>1
bahs $(FWDIR)/parse-logs.sh $LOG_FILE